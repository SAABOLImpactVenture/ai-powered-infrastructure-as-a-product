{
  "type": "Microsoft.Insights/scheduledQueryRules",
  "apiVersion": "2023-12-01-preview",
  "location": "global",
  "properties": {
    "displayName": "IaaP - Verify Failures (Last 30m)",
    "description": "Alert when infra evidence reports failures.",
    "severity": 2,
    "enabled": true,
    "evaluationFrequency": "PT5M",
    "scopes": [
      "/subscriptions/<your-sub-id>/resourceGroups/<rg>/providers/Microsoft.OperationalInsights/workspaces/<workspace-name>"
    ],
    "criteria": {
      "allOf": [
        {
          "query": "IaapInfraEvidence_CL | where TimeGenerated > ago(30m) | where tostring(status) =~ \"failure\"",
          "timeAggregation": "Count",
          "operator": "GreaterThan",
          "threshold": 0,
          "failingPeriods": {
            "numberOfEvaluationPeriods": 1,
            "minFailingPeriodsToAlert": 1
          }
        }
      ]
    },
    "autoMitigate": true,
    "muteActionsDuration": "PT10M",
    "actions": []
  }
}
