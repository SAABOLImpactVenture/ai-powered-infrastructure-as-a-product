apiVersion: v1
kind: Namespace
metadata:
  name: agents-tools
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: egress-allowlist
  namespace: agents-tools
data:
  hosts: "api.atlassian.com,api.github.com,jira.example.gov,confluence.example.gov"
---
apiVersion: v1
kind: Pod
metadata:
  name: mcp-tool-jira
  namespace: agents-tools
  labels:
    app: mcp-tool
    tool: jira
spec:
  runtimeClassName: gvisor
  securityContext:
    seccompProfile:
      type: RuntimeDefault
  containers:
    - name: tool
      image: ghcr.io/yourorg/mcp-tool-jira@sha256:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
      imagePullPolicy: Always
      args: ["--server", "--log-json"]
      envFrom:
        - secretRef:
            name: tool-jira-sp
      volumeMounts:
        - name: work
          mountPath: /work
          readOnly: true
      resources:
        limits:
          cpu: "500m"
          memory: "512Mi"
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities:
          drop: ["ALL"]
    - name: egress-proxy
      image: ghcr.io/yourorg/egress-allowlist-proxy@sha256:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
      args:
        - "--allow"
        - "$(ALLOWED_HOSTS)"
      env:
        - name: ALLOWED_HOSTS
          valueFrom:
            configMapKeyRef:
              name: egress-allowlist
              key: hosts
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities:
          drop: ["ALL"]
  volumes:
    - name: work
      emptyDir: {}
  enableServiceLinks: false
  hostNetwork: false
