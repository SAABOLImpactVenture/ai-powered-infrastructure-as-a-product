# syntax=docker/dockerfile:1
# Multi-stage Node â†’ Distroless Node runtime, non-root.
FROM node:20-slim AS build
WORKDIR /srv
COPY package.json package-lock.json* ./
RUN npm ci --omit=dev || npm ci
COPY . .

# Final: Distroless
FROM gcr.io/distroless/nodejs18-debian12
WORKDIR /srv
COPY --from=build /srv /srv
USER 65532:65532
EXPOSE 8081
# Health + metrics should be served by app (e.g., /healthz)
CMD ["server.js"]
